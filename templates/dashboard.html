{% extends 'base.html' %}

{% block title %}Meu Dashboard{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center mb-4" style="color: #3f51b5;">Dashboard de Resultados do Projeto</h1>
    <p class="text-center text-muted mb-5">
        Uma visão geral dos resultados e engajamento da fase piloto do TrilhaFuturo.
    </p>

    <div class="row mb-5">
        <div class="col-md-8">
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <h5 class="card-title text-center">Gráfico 1: Perfil dos Usuários (Piloto)</h5>
                    <div style="height: 300px;">
                        <canvas id="perfilUsuariosChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title text-center">Suas Ações</h5>
                    <p class="small text-center text-muted">Pronto para o próximo passo?</p>
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('teste') }}" class="btn btn-primary btn-lg">
                            <i class="bi bi-card-checklist me-2"></i>Fazer novo Teste
                        </a>
                        <a href="{{ url_for('feedback') }}" class="btn btn-outline-secondary">
                            <i class="bi bi-chat-left-text me-2"></i>Enviar Feedback
                        </a>
                        <a href="{{ url_for('chat') }}" class="btn btn-outline-secondary">
                            <i class="bi bi-robot me-2"></i>Chat com Mentor
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-5">
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title text-center">Gráfico 2: Perfis Vocacionais Identificados</h5>
                    <canvas id="perfisVocacionaisChart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title text-center">Gráfico 3: Análise Categórica dos Feedbacks</h5>
                    <canvas id="feedbackChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        
        // --- Dados Fictícios (os mesmos do Colab) ---
        const dadosPerfilUsuario = {
            labels: ['Estudante do Ensino Médio', 'Calouro Universitário', 'Em Transição de Carreira'],
            data: [30, 12, 8] // 60%, 25%, 15% de 50 usuários
        };

        const dadosPerfisVocacionais = {
            labels: ['Criativo', 'Analítico', 'Comunicador', 'Empreendedor'],
            data: [18, 15, 10, 7] // 35%, 30%, 20%, 15% de 50 usuários
        };

        const dadosFeedback = {
            labels: ['Usabilidade da Interface', 'Conteúdo do Teste', 'Design e Cores', 'Sugestão de Feature', 'Elogio Geral'],
            data: [7, 6, 5, 3, 2] // Baseado em 23 feedbacks
        };

        // --- Desenha Gráfico 1: Pizza (Perfil dos Usuários) ---
        const ctx1 = document.getElementById('perfilUsuariosChart').getContext('2d');
        new Chart(ctx1, {
            type: 'pie',
            data: {
                labels: dadosPerfilUsuario.labels,
                datasets: [{
                    label: 'Número de Usuários',
                    data: dadosPerfilUsuario.data,
                    backgroundColor: [
                        'rgba(63, 81, 181, 0.7)',
                        'rgba(255, 159, 64, 0.7)',
                        'rgba(75, 192, 192, 0.7)'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });

        // --- Desenha Gráfico 2: Barras (Perfis Vocacionais) ---
        const ctx2 = document.getElementById('perfisVocacionaisChart').getContext('2d');
        new Chart(ctx2, {
            type: 'bar',
            data: {
                labels: dadosPerfisVocacionais.labels,
                datasets: [{
                    label: 'Número de Usuários',
                    data: dadosPerfisVocacionais.data,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.7)',
                        'rgba(54, 162, 235, 0.7)',
                        'rgba(255, 206, 86, 0.7)',
                        'rgba(153, 102, 255, 0.7)'
                    ]
                }]
            },
            options: { scales: { y: { beginAtZero: true, ticks: { precision: 0 } } } }
        });

        // --- Desenha Gráfico 3: Barras Horizontais (Feedback) ---
        const ctx3 = document.getElementById('feedbackChart').getContext('2d');
        new Chart(ctx3, {
            type: 'bar',
            data: {
                labels: dadosFeedback.labels,
                datasets: [{
                    label: 'Número de Feedbacks',
                    data: dadosFeedback.data,
                    backgroundColor: 'rgba(255, 118, 0, 0.7)'
                }]
            },
            options: { indexAxis: 'y', scales: { x: { beginAtZero: true, ticks: { precision: 0 } } } }
        });
    });
</script>
{% endblock %}